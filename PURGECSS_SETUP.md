# PurgeCSS Setup Instructions

PurgeCSS has been configured in `vite.config.ts` to automatically remove unused CSS in production builds.

## Installation

To enable PurgeCSS, install the required package:

```bash
npm install --save-dev @fullhuman/postcss-purgecss
```

## How It Works

- **Development mode**: PurgeCSS is disabled - all CSS is included for development
- **Production mode**: PurgeCSS removes unused CSS during the build process

## Configuration

The configuration in `vite.config.ts` includes:

### Content Sources
PurgeCSS scans these files to find used CSS classes:
- `./index.html`
- `./src/**/*.{js,jsx,ts,tsx}`

### Safelist
Important classes that should NEVER be removed (dynamically generated classes):

**Standard classes:**
- Theme: `light`, `dark`
- Instrument modes: `keyboard-mode`, `guitar-mode`, `bass-mode`
- Note states: `selected`, `scale-note`, `chord-note`, `melody-note`, etc.
- Key classes: `white-key`, `black-key`
- Dynamic states: `active`, `open`, `closed`, `disabled`, `playing`, etc.

**Pattern-based (regex):**
- `/^instrument-/` - All classes starting with "instrument-"
- `/^keyboard-/` - All keyboard-related classes
- `/^guitar-/` - All guitar-related classes
- `/^bass-/` - All bass-related classes
- `/^note-/`, `/^scale-/`, `/^chord-/`, `/^melody-/` - Note/music classes

## Expected Results

### Before PurgeCSS:
- CSS Payload: ~50 KB (raw), ~12 KB (gzipped)

### After PurgeCSS:
- CSS Payload: ~35-40 KB (raw), ~8-10 KB (gzipped)
- **~20-30% additional reduction** in CSS file size

## Testing

1. Build the project:
```bash
npm run build
```

2. Check the bundle size in the build output

3. Test the production build to ensure no styling is missing:
```bash
npm run preview
```

4. Verify all dynamic states work correctly:
   - Switch between light/dark themes
   - Switch between keyboard/guitar/bass
   - Select notes, scales, chords
   - Test all interactive features

## Troubleshooting

If styles are missing after PurgeCSS:

1. Check if the class is dynamically generated by JavaScript
2. Add it to the `safelist.standard` array in `vite.config.ts`
3. Or add a pattern to `safelist.deep` or `safelist.greedy`

## Disabling PurgeCSS

If you need to disable PurgeCSS temporarily, you can:

1. Skip installation of `@fullhuman/postcss-purgecss`
2. Or build with: `NODE_ENV=development npm run build`

The configuration gracefully handles missing packages and will skip PurgeCSS if not installed.
